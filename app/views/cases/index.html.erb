<% unless request.xhr? %>
<div class="case-index">
    <div class="info_block">
      <h1 class="yellow_title_med">Cases</h1>
      <p>Cases exist primarily to be annotated in the <%= link_to 'collage', collages_path %> annotation engine.</p>
      <div class="layers">
        <% form_tag(url_for, :method => :get) do %>
          <h2>Filter by tags</h2>
          <p>
          <% @tags.each do|t| %>
            <div class="tag-container">
              <%= check_box_tag("tags[]",t.name, ((params[:tags] && params[:tags].include?(t.name)) ? true : false), {:class => 'tag-control', :id => "tag-control-#{t.id}"}) %><label for="tag-control-<%= t.id %>"><span class="c<%= t.id % 10 %>"><%=h t.name %></span></label>
            </div>
          <% end %>
          </p>
          <div class="clear spacer_block"></div>
          <%= check_box_tag('any', true,((params[:any]) ? true : false), {:id => 'any'}) %><label for="any">Match any tag</label>
          <input type="submit" class="button" value="Filter" /> <%= link_to('clear', url_for()) %>
        <% end %>
      </div>
    </div>
    <div class="spacer_block"></div>
  <% end %>


  <div class="list_block">
    <% if @cases.blank? %>
      <h2>None found.</h2>
    <% else %>

      <% unless request.xhr? %>
        <h2>Showing <%= (@cases.results.length > 1) ? "#{@cases.results.length} cases" : '1 case' %> of <%= @cases.hits.total_entries %> total
          <% if params[:tags] %>
            tagged with <%=h params[:tags].join((params[:any]) ? ' or ' : ' and ') %> 
          <% end %>
        </h2>

        <%= render :partial => 'shared/layout_components/per_page_selector' %>
      <% end %>

      <%= render :partial => 'case_list', :locals => {:cases => @cases } %>

    <% end %>
  </div>
  <% unless request.xhr? %>
    <%= render :partial => 'shared/layout_components/per_page_selector' %>
    <% if current_user %>
      <div class="info_block controls">
        <%= link_to 'New case', new_case_path, :class => 'button' %>
      </div>
    <% end %>
  <% end %> 
</div>
